
## asn1c 编译安装
- asn1c-0.9.28.tar.gz 比较容易安装，三步走就行。
  上面的包是 asn1c 官网提供的最新版本（2014-Sep-17）的库，但并没有对 oer 的编解码。不过好
  在其 github 上的版本好像更新一点，可以提供对 oer 的编解码。
  [asn1c](https://github.com/vlm/asn1c)
- 从 github 下载之后为 asn1c-master.zip，解压之后并没有 configure 文件，只有 configure.ac
  文件，这需要一些处理...
- 依赖库安装
  ```shell
    apt-get install libtool
  ``` 
- 参考
    + [源码目录下只有configure.ac文件和Makefile.am文件](https://blog.csdn.net/zhbpd/article/details/78179639)
    + [config.status: error: cannot find input file: `Makefile.in'](https://blog.csdn.net/qianggezhishen/article/details/48622999)
- 编译安装过程
    + 解压
      ```shell
        cd /usr/local/src
        unzip asn1c-master.zip
        cd asn1c-master
      ```
    + 生成 configure 文件，务必确保 automake 是最后一个执行的命令
      ```shell
       libtoolize --force
       aclocal
       autoconf
       autoheader
       automake --add-missing
      ```

    + 生成 makefile 文件
      ```shell
        ./configure --prefix=/usr/local/power-asn1c
      ```
    + 编译安装
      ```shell
        make
        make install
      ```
    + 链接到可搜索路径下
      ```shell
        ln -s /usr/local/power-asn1c/bin/asn1c /usr/bin/asn1c
      ```
    + 检测是否可运行
      以 rectangle.asn1 文件为例进行测试，内容如下：
      ```shell
        RectangleModule1 DEFINITIONS ::= BEGIN
            Rectangle ::= SEQUENCE 
            {
                height  INTEGER,
                width   INTEGER
            }
        END
      ```
      进行测试。
      ```shell
        asn1c -no-gen-example rectangle.asn1
        make -f converter-example.mk
      ```
      此时会生成可执行文件 converter-example 
      ```shell
        ./converter-example -h
      ```
## asn1c 命令
- 编译Module文件，生成相关C文件
  ```shell
    asn1c <modules.asn1>
  ```
- 如果多个文件包含信赖，则需要同时编译
  ```shell
    asn1c <module1.asn1> <module2.asn1> ...
  ```
- 检验asn1结构的语义正确性
  ```shell
    asn1c -EF Module.asn1
  ```
- 将编译结构打印到输出，而是不生成相关C文件
  ```shell
    asn1c -P Module.asn1
  ```
- 编译，但不生成帮助文件
  ```shell
    asn1c -R Module.asn1
  ```
- 创建用于对 Module 模块中的 ASN1结 构进行PER编解码的的源代码文件
  ```shell
    asn1c -gen-PER Module.asn1
    ```
- 创建用于对 Module 模块中的ASN1结构进行BER或XER编解码的源代码文件(默认)
  ```shell
    asn1c Module.asn1
  ```
- 生成能够对指定ASN1类型(以Circle为例)进行编码的可执行文件
  ```shell
    cc -DPDU=Circle -I. -o CircleDecoder.exe *.c
    cc -I. -o my-program *.c
  ```
- 常用命令(推荐使用)
  ```shell
    cc -g -O0 -I. *.c -D_DEFAULT_SOURCE -o myprogram
    cc -g -O0 *.c -D_DEFAULT_SOURCE -o myprogram
  ```

## 关于 asn1c 工具的 -fcompound-names 的选项
- asn1 文件太复杂时，在执行命令 asn1c xxx.asn 时可能会出现如下错误:
  ```shell
    FATAL: Name "e_content" is generated by MyModule.content at line v2x.asn:2609 and MyModule.content at line v2x.asn:2627
    FATAL: Name "enum content" is generated by MyModule.content at line v2x.asn:2609 and MyModule.content at line v2x.asn:2627
    FATAL: Name "content_PR" is generated by MyModule.content at line v2x.asn:2609 and MyModule.content at line v2x.asn:2627
    FATAL: Name "enum content_PR" is generated by MyModule.content at line v2x.asn:2609 and MyModule.content at line v2x.asn:2627
    FATAL: Name "struct content" is generated by MyModule.content at line v2x.asn:2609 and MyModule.content at line v2x.asn:2627
    FATAL: Name "content" is generated by MyModule.content at line v2x.asn:2609 and MyModule.content at line v2x.asn:2627
    FATAL: ... 55 more name clashes not shown
    FATAL: Use "-fcompound-names" flag to asn1c to resolve name clashes
  ```
  但是使用 asn1c -EF xxx.asn 进行语法检测时没有报错，在[ASN1 语法在线测试](https://asn1.io/asn1playground/)上面测试也没有问题。出现上述错误的原因是在生成 .c 文件时
  如果按照常规方式命名的话，会造成名字冲突。  
- 怎么解决最后一个 FATAL 已经给出了答案，使用 asn1c 的 -fcompound-names 选项，在生成源文件
  时，可以给名字添加修饰，以屏蔽底层 c 结构体的不兼容错误；